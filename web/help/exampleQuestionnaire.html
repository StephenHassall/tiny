<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Tiny Web Application Framework" />
  <meta name="keywords" content="HTML, CSS, JavaScript, Framework, Web Component" />
  <meta name="author" content="Stephen Paul Hassall" />
  <meta name="robots" content="all" />
  <link rel="icon" type="image/png" href="/tiny-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/tiny-16x16.png" sizes="16x16" />
  <link href="/tiny.css" rel="stylesheet" type="text/css" media="all" />
  <title>Tiny Web Application Framework Help - Example: Questionnaire</title>
</head>
<body>
  <!-- Header -->
  <div class="help-header">
    <a href="/index.html" class="help-header-logo">
      <img src="/tiny.svg" alt="Tiny Web Application Framework"></img>
    </a>
    <div class="help-header-title">Tiny Web Application Framework</div>
  </div>

  <!-- Help Side Bar -->
  <div class="help-side-bar">
    <div class="help-side-bar-group">
      <div class="help-side-bar-group-title">General:</div>
      <a href="index.html">Introduction</a>
      <a href="gettingStarted.html">Getting Started</a>
    </div>
    <div class="help-side-bar-group">
      <div class="help-side-bar-group-title">Reference:</div>
      <a href="controller.html">Controller</a>
      <a href="template.html">Template</a>
      <a href="templateArray.html">TemplateArray</a>
      <a href="form.html">Form</a>
      <a href="route.html">Route (SPA)</a>
      <a href="location.html">Location</a>
    </div>
    <div class="help-side-bar-group">
      <div class="help-side-bar-group-title">Examples:</div>
      <a href="exampleMultilingual.html">Multilingual</a>
      <a href="exampleLucky7.html">Lucky 7</a>
      <a href="exampleSimpleList.html">Simple List</a>
      <a href="exampleTodoList.html">Todo List</a>
      <a href="exampleQuestionnaire.html" class="help-side-bar-set">Questionnaire</a>
    </div>
    <div class="help-side-bar-group">
      <div class="help-side-bar-group-title">Extra:</div>
      <a href="limitations.html">Limitations</a>
      <a href="releaseNotes.html">Release Notes</a>
    </div>
  </div>

  <!-- Help Page -->
  <div class="help-page">
    <h2>Example: Questionnaire</h2>

    <h3>Overview</h3>

    <p>
      In this example we are looking at the <span class="label">Route</span> class and single page applications.
      The Questionnaire example has a number of questions, with each one having its own controller, and existing
      in its own view.
      There is also a global results class that all the questions have access to.
    </p>

    <h3>Single Page Routing</h3>

    <p>
      To create a single page application we derive our own class from the <span class="label">Route</span> class.
      We then add each of the views, in this case, each question view.
    </p>

<pre class="help-source">
<span class="js-purple">export default</span> <span class="js-blue">class</span> <span class="js-gray">SinglePageAppRoute</span> <span class="js-blue">extends</span> <span class="js-gray">Route</span> {
  <span class="js-blue">constructor</span>() {
    <span class="js-green">// Call the super first</span>
    <span class="js-blue">super</span>(<span class="js-purple">import</span>.meta.url);

    <span class="js-green">// Add route views</span>
    <span class="js-blue">this</span>.<span class="js-brown">add</span>({
      path: <span class="js-red">'/question1',</span>
      javaScriptPath: <span class="js-red">'question1.js',</span>
      controllerTagName: <span class="js-red">'question1-controller'</span>
    });
    <span class="js-blue">this</span>.<span class="js-brown">add</span>({
      path: <span class="js-red">'/question2',</span>
      javaScriptPath: <span class="js-red">'question2.js',</span>
      controllerTagName: <span class="js-red">'question2-controller'</span>
    });
    <span class="js-blue">this</span>.<span class="js-brown">add</span>({
      path: <span class="js-red">'/question3',</span>
      javaScriptPath: <span class="js-red">'question3.js',</span>
      controllerTagName: <span class="js-red">'question3-controller'</span>
    });
    <span class="js-blue">this</span>.<span class="js-brown">add</span>({
      path: <span class="js-red">'/end',</span>
      javaScriptPath: <span class="js-red">'end.js',</span>
      controllerTagName: <span class="js-red">'end-controller'</span>
    });
    <span class="js-blue">this</span>.<span class="js-brown">add</span>({
      path: <span class="js-red">'/error',</span>
      javaScriptPath: <span class="js-red">'error.js',</span>
      controllerTagName: <span class="js-red">'error-controller'</span>
    });

    <span class="js-green">// Add default views</span>
    <span class="js-blue">this</span>.<span class="js-brown">default</span>({
      javaScriptPath: <span class="js-red">'error.js',</span>
      controllerTagName: <span class="js-red">'error-controller'</span>
    });
  }
  ...
}

<span class="js-green">// Define controller web component</span>
customElements.<span class="js-brown">define</span>(<span class="js-red">'single-page-app-route'</span>, <span class="js-gray">SinglePageAppRoute</span>);
</pre>
          
    <p>
      The controller is created with the constructor that sets the default relative path for the JavaScript files.
      It calls the <span class="label">add</span> function to add the 3 questions, the end result view and an error view.
      Finally, it adds a default view, if the URL used doesn't match any of the given paths.
    </p>

    <h3>Questions</h3>

    <p>
      Each question view is very similar. They each have a question and give 4 possible answers. Each answer is recorded in the <span class="label">Results</span> class.
    </p>

<pre class="help-source">
<span class="html-green">&lt;!-- Question1 View --&gt</span>
<span class="html-brown">&lt;div</span> <span class="html-red">class</span>=<span class="html-blue">"question"</span><span class="html-brown">&gt;</span>
  <span class="html-brown">&lt;h3&gt;</span>Question #1<span class="html-brown">&lt;/h3&gt;</span>

  <span class="html-brown">&lt;p&gt;</span>How do you feel?<span class="html-brown">&lt;/p&gt;</span>

  <span class="html-brown">&lt;button</span> <span class="html-red">onclick</span>=<span class="html-blue">"</span><span class="js-brown">getController</span><span class="js-blue">(this)</span>.<span class="js-brown">answer</span><span class="js-blue">(</span><span class="js-gray">1</span><span class="js-blue">)"</span><span class="html-brown">&gt;</span>Top of the world<span class="html-brown">&lt;/button&gt;</span>
  <span class="html-brown">&lt;button</span> <span class="html-red">onclick</span>=<span class="html-blue">"</span><span class="js-brown">getController</span><span class="js-blue">(this)</span>.<span class="js-brown">answer</span><span class="js-blue">(</span><span class="js-gray">2</span><span class="js-blue">)"</span><span class="html-brown">&gt;</span>Alright I think<span class="html-brown">&lt;/button&gt;</span>
  <span class="html-brown">&lt;button</span> <span class="html-red">onclick</span>=<span class="html-blue">"</span><span class="js-brown">getController</span><span class="js-blue">(this)</span>.<span class="js-brown">answer</span><span class="js-blue">(</span><span class="js-gray">3</span><span class="js-blue">)"</span><span class="html-brown">&gt;</span>Could be better<span class="html-brown">&lt;/button&gt;</span>
  <span class="html-brown">&lt;button</span> <span class="html-red">onclick</span>=<span class="html-blue">"</span><span class="js-brown">getController</span><span class="js-blue">(this)</span>.<span class="js-brown">answer</span><span class="js-blue">(</span><span class="js-gray">4</span><span class="js-blue">)"</span><span class="html-brown">&gt;</span>Do not ask!<span class="html-brown">&lt;/button&gt;</span>
<span class="html-brown">&lt;/div&gt;</span>
</pre>

    <p>
      Each button has an inline <span class="label">onclick</span> event that calls the controller's <span class="label">answer</span> function.
    </p>

<pre class="help-source">
<span class="js-purple">import</span> Controller <span class="js-purple">from</span> <span class="js-red">"/lib/tiny/controller.js"</span>;
<span class="js-purple">import</span> Route <span class="js-purple">from</span> <span class="js-red">"/lib/tiny/route.js"</span>;
<span class="js-purple">import</span> Result <span class="js-purple">from</span> <span class="js-red">"./results.js"</span>;

<span class="js-purple">export default</span> <span class="js-blue">class</span> <span class="js-gray">Question1Controller</span> <span class="js-blue">extends</span> <span class="js-gray">Controller</span> {
  <span class="js-blue">constructor</span>() {
    <span class="js-green">// Call the super with the page to load</span>
    <span class="js-blue">super</span>({
      htmlPath: <span class="js-red">'question1.html'</span>,
      importMetaUrl: <span class="js-purple">import</span>.meta.url
    });
  }

  <span class="js-brown">answer</span>(result) {
    <span class="js-green">// Set the answer given</span>
    <span class="js-gray">Results</span>.question1 = result;

    <span class="js-green">// Go to the next question view</span>
    <span class="js-gray">Route</span>.<span class="js-brown">gotoView</span>(<span class="js-red">'/question2'</span>);
  }
}

<span class="js-green">// Define controller web component</span>
customElements.<span class="js-brown">define</span>(<span class="js-red">'question1-controller'</span>, <span class="js-gray">Question1Controller</span>);
</pre>

    <p>
      The question controller is created passing the path to the question HTML file.
      The <span class="label">answer</span> function sets the <span class="label">Results</span> property for the question
      and then goes to the view for the next question. After question 3 it will move to the end view.
    </p>      

    <h3>Results Class</h3>

    <p>
      The answers to the 3 questions are stored in a global <span class="label">Results</span> class.
    </p>

<pre class="help-source">
<span class="js-purple">export default</span> <span class="js-blue">class</span> <span class="js-gray">Results</span> {
  <span class="js-green">// Question 1</span>
  <span class="js-blue">static</span> question1 = -<span class="js-green">1</span>;

  <span class="js-green">// Question 2</span>
  <span class="js-blue">static</span> question2 = -<span class="js-green">1</span>;

  <span class="js-green">// Question 3</span>
  <span class="js-blue">static</span> question3 = -<span class="js-green">1</span>;
}
</pre>

    <p>
      The answers are all static properties. This means they are global but also that the <span class="label">Results</span> class
      does not need to created as an object before it is used.
    </p>

    <h3>End Results View</h3>

    <p>
      After the 3 questions have been answered the user is moved to the end results page.
    </p>

<pre class="help-source">
<span class="html-green">&lt;!-- End View --&gt</span>
<span class="html-brown">&lt;div</span> <span class="html-red">class</span>=<span class="html-blue">"question"</span><span class="html-brown">&gt;</span>
  <span class="html-brown">&lt;div</span> <span class="html-red">class</span>=<span class="html-blue">"templateArea"</span><span class="html-brown">&gt;</span>
    <span class="html-brown">&lt;h3&gt;</span>Results<span class="html-brown">&lt;/h3&gt;</span>

    <span class="html-brown">&lt;p&gt;</span>
      How do you feel?
      <span class="html-brown">&lt;br&gt;</span>
      <span class="html-brown">&lt;i&gt;</span>
        <span class="html-brown">&lt;span</span> <span class="html-red">class</span>=<span class="html-blue">"${this.results.question1===1 ? '' : 'hidden'}"</span><span class="html-brown">&gt;</span>Top of the world<span class="html-brown">&lt;/span&gt;</span>
        <span class="html-brown">&lt;span</span> <span class="html-red">class</span>=<span class="html-blue">"${this.results.question1===2 ? '' : 'hidden'}"</span><span class="html-brown">&gt;</span>Alright I think<span class="html-brown">&lt;/span&gt;</span>
        <span class="html-brown">&lt;span</span> <span class="html-red">class</span>=<span class="html-blue">"${this.results.question1===3 ? '' : 'hidden'}"</span><span class="html-brown">&gt;</span>Could be better<span class="html-brown">&lt;/span&gt;</span>
        <span class="html-brown">&lt;span</span> <span class="html-red">class</span>=<span class="html-blue">"${this.results.question1===4 ? '' : 'hidden'}"</span><span class="html-brown">&gt;</span>Do not ask!<span class="html-brown">&lt;/span&gt;</span>
      <span class="html-brown">&lt;/i&gt;</span>
    <span class="html-brown">&lt;/p&gt;</span>

    <span class="html-brown">&lt;p&gt;</span>
      Just how bored are you?
      <span class="html-brown">&lt;br&gt;</span>
      <span class="html-brown">&lt;i&gt;</span>
        <span class="html-brown">&lt;span</span> <span class="html-red">class</span>=<span class="html-blue">"${this.results.question2===1 ? '' : 'hidden'}"</span><span class="html-brown">&gt;</span>I'm a coder, boredom is my middle name<span class="html-brown">&lt;/span&gt;</span>
        <span class="html-brown">&lt;span</span> <span class="html-red">class</span>=<span class="html-blue">"${this.results.question2===2 ? '' : 'hidden'}"</span><span class="html-brown">&gt;</span>I've had a coffee. Nothing bores me<span class="html-brown">&lt;/span&gt;</span>
        <span class="html-brown">&lt;span</span> <span class="html-red">class</span>=<span class="html-blue">"${this.results.question2===3 ? '' : 'hidden'}"</span><span class="html-brown">&gt;</span>I didn't even read the question<span class="html-brown">&lt;/span&gt;</span>
        <span class="html-brown">&lt;span</span> <span class="html-red">class</span>=<span class="html-blue">"${this.results.question2===4 ? '' : 'hidden'}"</span><span class="html-brown">&gt;</span>Next stupid question<span class="html-brown">&lt;/span&gt;</span>
      <span class="html-brown">&lt;/i&gt;</span>
    <span class="html-brown">&lt;/p&gt;</span>

    <span class="html-brown">&lt;p&gt;</span>
      As examples go, just how brilliant is this one?
      <span class="html-brown">&lt;br&gt;</span>
      <span class="html-brown">&lt;i&gt;</span>
        <span class="html-brown">&lt;span</span> <span class="html-red">class</span>=<span class="html-blue">"${this.results.question3===1 ? '' : 'hidden'}"</span><span class="html-brown">&gt;</span>Example? I thought this was real!<span class="html-brown">&lt;/span&gt;</span>
        <span class="html-brown">&lt;span</span> <span class="html-red">class</span>=<span class="html-blue">"${this.results.question3===2 ? '' : 'hidden'}"</span><span class="html-brown">&gt;</span>I'm tempted to create a better one<span class="html-brown">&lt;/span&gt;</span>
        <span class="html-brown">&lt;span</span> <span class="html-red">class</span>=<span class="html-blue">"${this.results.question3===3 ? '' : 'hidden'}"</span><span class="html-brown">&gt;</span>My pet cat has come up with better<span class="html-brown">&lt;/span&gt;</span>
        <span class="html-brown">&lt;span</span> <span class="html-red">class</span>=<span class="html-blue">"${this.results.question3===4 ? '' : 'hidden'}"</span><span class="html-brown">&gt;</span>Please, make it stop<span class="html-brown">&lt;/span&gt;</span>
      <span class="html-brown">&lt;/i&gt;</span>
    <span class="html-brown">&lt;/p&gt;</span>
  <span class="html-brown">&lt;/div&gt;</span>

  <span class="html-brown">&lt;button</span> <span class="html-red">onclick</span>=<span class="html-blue">"</span><span class="js-brown">getController</span><span class="js-blue">(this)</span>.<span class="js-brown">restart</span><span class="js-blue">()"</span><span class="html-brown">&gt;</span>Restart<span class="html-brown">&lt;/button&gt;</span>
<span class="html-brown">&lt;/div&gt;</span>
</pre>

    <p>
      The template area will be used with the result class to only show the answers that were selected.
      The <span class="label">Restart</span> button is used to call the controller's restart function that
      will redirect the page to the start of the questionnaire.
    </p>

    <h3>Default View and Errors</h3>

    <p>
      What happens if you refresh the page on question 2? The answer to question 1 will be lost. We need a way to
      check before loading the view whether the questionnaire is still valid.
      Also, what if the URL is changed to look for question 4, which does not exist.
      In both cases we need to move to the error view.
    </p>

<pre class="help-source">
<span class="html-green">&lt;!-- Error View --&gt</span>
<span class="html-brown">&lt;div</span> <span class="html-red">class</span>=<span class="html-blue">"question"</span><span class="html-brown">&gt;</span>
  <span class="html-brown">&lt;h3&gt;</span>Error<span class="html-brown">&lt;/h3&gt;</span>

  <span class="html-brown">&lt;p&gt;</span>Looks like something has gone wrong.<span class="html-brown">&lt;/p&gt;</span>

  <span class="html-brown">&lt;button</span> <span class="html-red">onclick</span>=<span class="html-blue">"</span><span class="js-brown">getController</span><span class="js-blue">(this)</span>.<span class="js-brown">restart</span><span class="js-blue">()"<span class="html-brown">&gt;</span>Restart<span class="html-brown">&lt;/button&gt;</span>
<span class="html-brown">&lt;/div&gt;</span>
</pre>

    <p>
      This is the default view that is shown when there is an error.
      The restart button will call the controller's <span class="label">restart</span> function, which will go to the question 1 view.
    </p>

    <p>
      Look back to the <span class="label">SinglePageApp</span> constructor and see that we called the <span class="label">default</span> function.
      This was used to set which view would be shown if the URL part did not match any of the set view paths.
    </p>

    <p>
      To check to see if the page has been refreshed in the middle of the questionnaire, we need to override the Route class's
      <span class="label">beforeLoad</span> function.
    </p>
      
<pre class="help-source">
<span class="js-brown">beforeLoad</span>(route) {
  <span class="js-green">// Set error</span>
  <span class="js-blue">let</span> error = <span class="js-blue">false</span>;

  <span class="js-green">// Check for errors</span>
  <span class="js-purple">if</span> (route.path === <span class="js-red">'/question2'</span> && <span class="js-gray">Results</span>.question1 === -<span class="js-green">1</span>) error = <span class="js-blue">true</span>;
  <span class="js-purple">if</span> (route.path === <span class="js-red">'/question3'</span> && <span class="js-gray">Results</span>.question2 === -<span class="js-green">1</span>) error = <span class="js-blue">true</span>;
  <span class="js-purple">if</span> (route.path === <span class="js-red">'/end'</span> && <span class="js-gray">Results</span>.question3 === -<span class="js-green">1</span>) error = <span class="js-blue">true</span>;

  <span class="js-green">// If there is no error</span>
  <span class="js-purple">if</span> (error === <span class="js-blue">false</span>) <span class="js-purple">return</span> <span class="js-blue">true</span>;

  <span class="js-green">// Set to go to error page</span>
  <span class="js-gray">Route</span>.<span class="js-brown">gotoView</span>(<span class="js-red">'/error'</span>);

  <span class="js-green">// Return error</span>
  <span class="js-purple">return</span> <span class="js-blue">false</span>;
}
</pre>

    <p>
      We check the route's path and make sure the answer to the previous question has been set.
      If there is something wrong then we go to the error view and return false, which stops the previous view
      being shown.
    </p>

    <h3>Putting it all together</h3>

    <p>
      The last thing we need to do is put everything together on a main page.
    </p>

<pre class="help-source">
<span class="html-brown">&lt;!DOCTYPE</span> <span class="html-red">html</span><span class="html-brown">&gt;</span>
<span class="html-brown">&lt;html</span> <span class="html-red">lang</span>=<span class="html-blue">"en"</span><span class="html-brown">&gt;</span>
<span class="html-brown">&lt;header&gt;</span>
  <span class="html-brown">&lt;title&gt;</span>Tiny Web Application Framework - Example: Questionnaire<span class="html-brown">&lt;/title&gt;</span>
  <span class="html-brown">&lt;link</span> <span class="html-red">href</span>=<span class="html-blue">"questionnaire.css"</span> <span class="html-red">ref</span>=<span class="html-blue">"stylesheet"</span><span class="html-brown">&gt;</span>
  <span class="html-brown">&lt;script</span> <span class="html-red">type</span>=<span class="html-blue">"module"</span> <span class="html-red">src</span>=<span class="html-blue">"questionnaire.js"</span><span class="html-brown">&gt;&lt;/script&gt;</span>
<span class="html-brown">&lt;/header&gt;</span>
<span class="html-brown">&lt;body&gt;</span>
  <span class="html-brown">&lt;single-page-app-route&gt;&lt;/single-page-app-route&gt;</span>
<span class="html-brown">&lt;/body&gt;</span>
</pre>
      
    <p>
      We need to include the route's JavaScript file.
      Make sure you include the <span class="label">type="module"</span> attribute when working with web components.
      Then simply add the route's tag.
      This is the <span class="label">&lt;single-page-app-route&gt;</span> parts.
      You can see the page working <a class="source-link" href="../examples/questionnaire/index.html#!/question1">here</a>.
    </p>

    <!-- Footer -->
    <div class="footer">
      <a href="exampleTodoList.html">&lt; Todo List</a>
      <a href="limitations.html">Limitations &gt;</a>
    </div>

  </div>
</body>